
  
  <div class="container py-5 px-6 ">

    <div class="row">
      <div class="col-12 col-lg-10 col-xl-8 mx-auto form-outer">
        <div class="card">
         
          <div class="card-body">
  <input id="pac-input" class="controls" type="text" placeholder="搜尋google地圖" />
  <div class="w-75 h-25  position-absolute mt-5" id="map" style="margin-left:76px"></div>
  <div style=" margin-top: 400px">
  <div id="infowindow-content">
    <span id="place-name" class="title" ></span><br />
    <span id="place-address"></span>
  </div>
  <form action="/restaurants" enctype="multipart/form-data" method="POST" class="form">
    
      <div class="row g-2 mb-3">
        <label for="restaurantName" class="col-md-4  col-form-label align-items-center">餐廳名字</label>
        <div class="col-md-9">
        <input type="text" class="form-control" name="name" placeholder="" id="restaurantName"required>
      </div>
      </div>
      <div class="row g-2 mb-3">
        <label for="restaurantNameEn" class="col-md-4  col-form-label align-items-center">餐廳英文名字</label>
        <div class="col-md-9">
        <input type="text" class="form-control" name="name_en" placeholder=""d="restaurantNameEn">
        </div>
      </div>
      <div class="row g-2 mb-3">
        <label for="restaurantLocation" class="col-md-4  col-form-label align-items-center">餐廳地址</label>
        <div class="col-md-9">
        <input type="text" class="form-control" name="location" placeholder="" id="restaurantLocation" required>
        </div>
      </div>
      <div class="row g-2 mb-3">
        <label for="googleMapLocation" class="col-md-4  col-form-label align-items-center">Google map網址</label>
        <div class="col-md-9">
          <input type="text" class="form-control" name="google_map" placeholder="" id="googleMapLocation">
        </div>
      </div>
      <div class="row g-2 mb-3">
        <label for="restaurantPhone"class="col-md-4  col-form-label align-items-center">餐廳電話</label>
        <div class="col-md-9">
        <input type="tel" class="form-control" name="phone" placeholder="02 XXXX XXXX" id="restaurantPhone">
        </div>
      </div>
      <div class="row g-2 mb-3">
        <label for="image" class="col-md-4  col-form-label align-items-center position-relative">上傳圖片</label>
        <div class="col-md-9 imageCard">
          <input type="file" class="form-control image" name="image" placeholder="請貼上網址" id="image">
        </div>
        <div class="imageUpload"></div>
        </div>
      <div class="row g-2 form-group mb-5">
        <label for="restaurantCategory"class="col-md-4  col-form-label align-items-center">餐廳種類</label>
        <div class="col-md-9">
          <select name="category" id="restaurantCategory"class="form-select" aria-label="restaurantCategory"required>
            <option selected  disabled hidden>選擇餐廳種類</option>
            <option >美式</option>
            <option >咖啡</option>
            <option >中東料理</option>
            <option >日本料理</option>
            <option >義式餐廳</option>
            <option >酒吧</option>
            <option >其他</option>
          </select>
          </div>
      </div>
      <div>
        <label for="customRange2" class="form-label">評分</label>
        </div>
      <fieldset class="rating mb-3">
        <input type="radio" id="star5" name="rating" value="5" /><label class="full" for="star5"
          title="Awesome - 5 stars"></label>
        <input type="radio" id="star4half" name="rating" value="4.5" /><label class="half" for="star4half"
          title="Pretty good - 4.5 stars"></label>
        <input type="radio" id="star4" name="rating" value="4" /><label class="full" for="star4"
          title="Pretty good - 4 stars"></label>
        <input type="radio" id="star3half" name="rating" value="3.5" /><label class="half" for="star3half"
          title="Meh - 3.5 stars"></label>
        <input type="radio" id="star3" name="rating" value="3" /><label class="full" for="star3"
          title="Meh - 3 stars"></label>
        <input type="radio" id="star2half" name="rating" value="2.5" /><label class="half" for="star2half"
          title="Kinda bad - 2.5 stars"></label>
        <input type="radio" id="star2" name="rating" value="2" /><label class="full" for="star2"
          title="Kinda bad - 2 stars"></label>
        <input type="radio" id="star1half" name="rating" value="1.5" /><label class="half" for="star1half"
          title="Meh - 1.5 stars"></label>
        <input type="radio" id="star1" name="rating" value="1" /><label class="full" for="star1"
          title="Sucks big time - 1 star"></label>
        <input type="radio" id="starhalf" name="rating" value="0.5" /><label class="half" for="starhalf"
          title="Sucks big time - 0.5 stars"></label>
      </fieldset>
      
      <div class=" mb-4">
        <textarea class="form-control" id="restaurantDescription" name="description" rows="3"placeholder="請寫下關於餐廳的介紹" ></textarea>
      </div>
      
    
    <button type="submit" class="btn btn-major">儲存</button>

  </form>
  </div>
</div>
</div>
</div>
</div>

<script>
  {{!-- 預覽圖片 --}}
  const image = document.querySelector('#image')
  const imageUpload = document.querySelector('.imageUpload')
  const imageCard = document.querySelector('.imageCard')
  //若input有新增或更改檔案則出現預覽的圖片
  image.addEventListener('change', event => {
    const ObjectURL = window.URL.createObjectURL(event.target.files[0])
    imageUpload.innerHTML = `<img src="${ObjectURL}" class="mt-3 mx-3">`
  })
  {{!-- google地圖 --}}
  const address = document.querySelector('#restaurantLocation')
  const name = document.querySelector('#restaurantName')
  const google_map = document.querySelector('#googleMapLocation')
  function initMap () {
    //設定一開始的地圖位置
      const defaultPosition = { lat: 23.546162, lng: 120.6402133 }
      const map = new google.maps.Map(document.getElementById("map"), {
      center: defaultPosition,
      zoom: 8,
      mapTypeControl: false
    })
      //設定彈跳的資訊框
    const infowindowContent = document.getElementById("infowindow-content")
    const infoWindow = new google.maps.InfoWindow()
    infoWindow.setContent(infowindowContent)
     //若使用定位功能，則顯示並標示所在位置
    let marker
    if (navigator.geolocation.length) {
      navigator.geolocation.getCurrentPosition(function (position) {
        const pos = {
          lat: position.coords.latitude,
          lng: position.coords.longitude
        };
        marker = new google.maps.Marker({
          position: pos,
          map: map
        });
        map.setZoom(17);
        map.setCenter(pos);
      });
    //若沒有使用定位功能，則顯示預設的地圖位置
    }else{
      marker = new google.maps.Marker({
        position: defaultPosition,
        map: map,
        visible: false
      });
    }
    //設定搜尋框的搜尋條件
    const input = document.getElementById("pac-input")
    map.controls[google.maps.ControlPosition.TOP_LEFT].push(input)
    const autoComplete = new google.maps.places.Autocomplete(input,{
      componentRestrictions: { country: "tw" },
      fields: ["formatted_address", "name", "url", "photo", "geometry"],
      strictBounds: false,
      types: ["bar", "cafe", "restaurant", "store"]
    })
    //搜尋框的事件監聽
    autoComplete.addListener("place_changed", () => {
      infoWindow.close();
      marker.setVisible(false);
      //取得輸入地點的資訊
      const place = autoComplete.getPlace();
       if (!place.geometry || !place.geometry.location) {
        // User entered the name of a Place that was not suggested or the Place Details request failed.
        window.alert(`搜尋不到${place.name}`);
        return;
      }
     // If the place has a geometry, then present it on a map.
      if (place.geometry.viewport) {
        map.fitBounds(place.geometry.viewport);
      } else {
        map.setCenter(place.geometry.location);
        map.setZoom(17);
      }
      marker.setPosition(place.geometry.location);
      marker.setVisible(true);
      //將餐廳資料帶入資訊框
      infowindowContent.children["place-name"].textContent = place.name;
      infowindowContent.children["place-address"].textContent = place.formatted_address;
      infoWindow.open(map, marker);
      //將餐廳資料帶入到要建立的表單
      address.value = place.formatted_address || ""
      name.value = place.name
      google_map.value = place.url || ""
      const URL = place.photos[0].getUrl()|| "https://via.placeholder.com/200"
      imageCard.innerHTML = ` <input type="text" class="form-control" name="image" placeholder="" id="uploadURL" value="${URL}"required><img src="${URL}" class="mt-3 mx-3">`
    })
  }  
 window.initMap = initMap
</script>